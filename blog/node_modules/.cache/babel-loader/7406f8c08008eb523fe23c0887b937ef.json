{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/hp/Desktop/vue\\u5B9E\\u62181/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/Users/hp/Desktop/vue\\u5B9E\\u62181/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.regexp.test.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.regexp.constructor.js\";\nimport \"core-js/modules/es.regexp.dot-all.js\";\nimport \"core-js/modules/es.regexp.sticky.js\";\nimport \"core-js/modules/es.regexp.to-string.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/web.url.js\";\nimport \"core-js/modules/web.url-search-params.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nexport default {\n  name: 'ArticleAdd',\n  data: function data() {\n    return {\n      ruleForm: {\n        title: '',\n        des: '',\n        md: '',\n        cover: ''\n      },\n      imageUrl: '',\n      baseURL: 'http://localhost:4000'\n    };\n  },\n  methods: {\n    //提交按钮\n    submitForm: function submitForm() {\n      var _this = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var a;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                a = _this.$refs.mdForm.submit();\n                console.log(a);\n\n              case 2:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }))();\n    },\n    //文件上传的检测\n    fileChange: function fileChange(file, fileList) {\n      if (file.status !== 'ready') return;\n\n      if (/^(.+)\\.md$/.test(file.name)) {\n        if (this.ruleForm.title) return;\n        this.ruleForm.title = RegExp.$1;\n      } else {\n        this.$message.error('只能上传md文件');\n        console.log('no');\n        fileList.pop();\n      }\n    },\n    //删除md文件之前的钩子\n    beforeRemove: function beforeRemove() {\n      this.ruleForm.title = '';\n    },\n    //md上传成功的钩子\n    md_upload_success: function md_upload_success(res) {\n      //md上传失败\n      if (res.code) {\n        return this.$message.error(\"上传md失败，请检查后端报错\");\n      } //md上传成功\n\n\n      this.form.md = res.url; //判断是否有封面图\n\n      if (this.imageUrl) {\n        //有封面图，触发封面图的上传\n        this.$refs.imgForm.submit();\n      } else {\n        //没有封面图，直接发表文章\n        this.submit();\n      }\n    },\n    //添加封面的钩子\n    coverChange: function coverChange(file, fileList) {\n      if (file.status !== 'ready') return;\n      var isJPG = /^image\\/(jpeg|png)$/.test(file.raw.type);\n      var isLt2M = file.raw.size / 1024 / 1024 < 2;\n\n      if (!isJPG) {\n        this.$message.error('上传头像图片只能是 JPG/PNG 格式!');\n      }\n\n      if (!isLt2M) {\n        this.$message.error('上传头像图片大小不能超过 2MB!');\n      }\n\n      if (isJPG && isLt2M) {\n        this.imageUrl = URL.createObjectURL(file.raw);\n      } else {\n        this.imageUrl = \"\";\n        fileList.pop();\n      }\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyDA;EACAA,kBADA;EAEAC,IAFA,kBAEA;IACA;MACAC;QACAC,SADA;QAEAC,OAFA;QAGAC,MAHA;QAIAC;MAJA,CADA;MAOAC,YAPA;MAQAC;IARA;EAUA,CAbA;EAcAC;IACA;IACAC,UAFA,wBAEA;MAAA;;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACAC,CADA,GACA,2BADA;gBAEAC;;cAFA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAGA,CALA;IAMA;IACAC,UAPA,sBAOAC,IAPA,EAOAC,QAPA,EAOA;MACA;;MACA;QACA;QACA;MACA,CAHA,MAGA;QACA;QACAH;QACAG;MACA;IACA,CAjBA;IAkBA;IACAC,YAnBA,0BAmBA;MACA;IACA,CArBA;IAsBA;IACAC,iBAvBA,6BAuBAC,GAvBA,EAuBA;MACA;MACA;QACA;MACA,CAJA,CAKA;;;MACA,uBANA,CAOA;;MACA;QACA;QACA;MACA,CAHA,MAGA;QACA;QACA;MACA;IACA,CAtCA;IAuCA;IACAC,WAxCA,uBAwCAL,IAxCA,EAwCAC,QAxCA,EAwCA;MACA;MAEA;MACA;;MAEA;QACA;MACA;;MACA;QACA;MACA;;MACA;QACA;MACA,CAFA,MAEA;QACA;QACAA;MACA;IACA;EA1DA;AAdA","names":["name","data","ruleForm","title","des","md","cover","imageUrl","baseURL","methods","submitForm","a","console","fileChange","file","fileList","beforeRemove","md_upload_success","res","coverChange"],"sourceRoot":"src/components/Admin","sources":["ArticleAdd.vue"],"sourcesContent":["<template>\r\n    <div id=\"ArticleAdd\">\r\n        <el-form \r\n        :model=\"ruleForm\"  \r\n        ref=\"ruleForm\" \r\n        label-position=\"top\"\r\n        >\r\n            <el-form-item label=\"标题\">\r\n                <el-input v-model=\"ruleForm.title\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"描述\">\r\n                <el-input v-model=\"ruleForm.des\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"内容\">\r\n                <el-upload\r\n                    class=\"upload-demo\"\r\n                    drag\r\n                    :action=\"`${baseURL}/adminServer/article/md`\"\r\n                    :auto-upload=\"false\"\r\n                    :on-change=\"fileChange\"\r\n                    :limit=\"1\"\r\n                    :before-remove=\"beforeRemove\"\r\n                    :on-success=\"md_upload_success\"\r\n                    ref=\"mdForm\"\r\n                    :with-credentials=\"true\"\r\n                    >\r\n                        <i class=\"el-icon-upload\"></i>\r\n                        <div class=\"el-upload__text\">将文件拖到此处，或<em>点击上传</em></div>\r\n                </el-upload>\r\n            </el-form-item>\r\n            <el-form-item label=\"封面\">\r\n                <el-upload\r\n                    class=\"avatar-uploader\"\r\n                    :action=\"`${baseURL}/adminServer/article/cover`\"\r\n                    :show-file-list=\"false\"\r\n                    :on-change=\"coverChange\"\r\n                    :auto-upload=\"false\"\r\n                    ref=\"imgForm\"\r\n                    :with-credentials=\"true\"\r\n                    >\r\n                        <div \r\n                        v-if=\"imageUrl\" \r\n                        class=\"avatar\"\r\n                        :style=\"{backgroundImage: `url(${imageUrl})`}\"\r\n                        >\r\n                        </div>\r\n                        <i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\r\n                </el-upload>\r\n            </el-form-item>\r\n            <el-form-item>\r\n                <el-button type=\"primary\" @click=\"submitForm\">提交</el-button>\r\n            </el-form-item>\r\n        </el-form>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n    name: 'ArticleAdd',\r\n    data() {\r\n        return {\r\n            ruleForm: {\r\n                title: '',\r\n                des: '',\r\n                md: '',\r\n                cover: ''\r\n            },\r\n            imageUrl: '',\r\n            baseURL: 'http://localhost:4000'\r\n        }\r\n    },\r\n    methods: {\r\n        //提交按钮\r\n        async submitForm() {\r\n            let a = this.$refs.mdForm.submit()\r\n            console.log(a)\r\n        },\r\n        //文件上传的检测\r\n        fileChange(file, fileList) {\r\n            if (file.status !== 'ready') return\r\n            if(/^(.+)\\.md$/.test(file.name)){\r\n                if(this.ruleForm.title) return\r\n                this.ruleForm.title = RegExp.$1\r\n            }else {\r\n                this.$message.error('只能上传md文件')\r\n                console.log('no')\r\n                fileList.pop()\r\n            }\r\n        },\r\n        //删除md文件之前的钩子\r\n        beforeRemove(){\r\n            this.ruleForm.title = ''\r\n        },\r\n        //md上传成功的钩子\r\n        md_upload_success(res) {\r\n            //md上传失败\r\n            if (res.code) {\r\n                return this.$message.error(\"上传md失败，请检查后端报错\")\r\n            }\r\n            //md上传成功\r\n            this.form.md = res.url\r\n            //判断是否有封面图\r\n            if (this.imageUrl) {\r\n                //有封面图，触发封面图的上传\r\n                this.$refs.imgForm.submit()\r\n            } else {\r\n                //没有封面图，直接发表文章\r\n                this.submit()\r\n            }\r\n        },\r\n        //添加封面的钩子\r\n    coverChange(file, fileList) {\r\n      if (file.status !== 'ready') return\r\n\r\n      const isJPG = /^image\\/(jpeg|png)$/.test(file.raw.type);\r\n      const isLt2M = file.raw.size / 1024 / 1024 < 2;\r\n\r\n      if (!isJPG) {\r\n        this.$message.error('上传头像图片只能是 JPG/PNG 格式!');\r\n      }\r\n      if (!isLt2M) {\r\n        this.$message.error('上传头像图片大小不能超过 2MB!');\r\n      }\r\n      if (isJPG && isLt2M) {\r\n        this.imageUrl = URL.createObjectURL(file.raw);\r\n      } else {\r\n        this.imageUrl = \"\"\r\n        fileList.pop()\r\n      }\r\n    },\r\n    }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n#ArticleAdd {\r\n    /deep/.avatar-uploader .el-upload {\r\n        border: 1px dashed #d9d9d9;\r\n        border-radius: 6px;\r\n        cursor: pointer;\r\n        position: relative;\r\n        overflow: hidden;\r\n    }\r\n    /deep/.avatar-uploader .el-upload:hover {\r\n        border-color: #409EFF;\r\n    }\r\n    /deep/.avatar-uploader-icon {\r\n        font-size: 28px;\r\n        color: #8c939d;\r\n        width: 178px;\r\n        height: 178px;\r\n        line-height: 178px;\r\n        text-align: center;\r\n    }\r\n    /deep/.avatar {\r\n        width: 178px;\r\n        height: 178px;\r\n        display: block;\r\n        background: none center center/cover;\r\n    }\r\n} \r\n</style>"]},"metadata":{},"sourceType":"module"}